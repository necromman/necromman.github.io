# 콘텐츠 제작 워크플로우 & 에이전트 시스템

## 최상위 규칙

1. **모든 콘텐츠 요청은 Phase 0(조사)부터 시작한다.** 건너뛸 수 없다.
2. **Orchestrator가 콘텐츠 유형을 판별하고, 적절한 에이전트 팀을 동적으로 구성한다.**
3. **소설/창작 콘텐츠는 반드시 세계관·캐릭터·스토리 설계를 거친 뒤 집필한다.**
4. **검증 없는 콘텐츠는 완성이 아니다.** Editor + Fact Checker가 반드시 검수한다.

---

## 콘텐츠 유형 분류

Orchestrator는 사용자 요청을 분석하여 아래 3가지 유형 중 하나로 분류한다:

| 유형 | 설명 | 예시 |
|------|------|------|
| **정보전달형** (Informational) | 사실/분석/해설 중심. 데이터와 논리로 구성 | 기술 해설, 트렌드 분석, 영상 요약 |
| **소설형** (Fiction) | 창작 서사. 세계관·캐릭터·플롯이 핵심 | 판타지 단편, SF 시리즈, 문학 창작 |
| **혼합형** (Hybrid) | 정보를 소설 형식으로 전달 | 소설로 풀어낸 기술 해설, 우화식 교훈 |

**분류 기준:**
- 사용자가 "소설", "이야기", "창작", "단편", "시리즈 소설" 등을 언급 → **소설형**
- 사용자가 "정리", "분석", "요약", "해설" 등을 언급 → **정보전달형**
- 정보 전달이 목적이나 소설/서사 형식 요청 → **혼합형**
- 판별 불가 시 → 사용자에게 확인

---

## 에이전트 구성

### 공통 에이전트 (모든 유형에 참여)

| 에이전트 | 역할 | 참여 |
|----------|------|------|
| **Orchestrator** | 유형 판별, 에이전트 팀 구성, 파이프라인 조율, 품질 게이트 관리 | **항상** |
| **Researcher** | 자료 조사, 기존 컨벤션 분석, 사실 검증용 데이터 수집 | **항상 (Phase 0)** |
| **Planner** | 시리즈 구조 설계, 편별 구성, 전체 흐름 | **항상 (Phase 1)** |
| **Editor** | 품질 검수, 반복 표현 탐지, 클리셰 제거, 문체 정제 | **항상 (Phase 3)** |
| **Publisher** | SEO, front matter, sitemap, 배포 준비 | **항상 (Phase 4)** |

### 소설 전용 에이전트 (소설형/혼합형에만 참여)

| 에이전트 | 역할 | 참여 조건 |
|----------|------|----------|
| **World Builder** | 세계관 설계, 설정 일관성, 시간축, 지리, 마법/기술 체계 | 소설형, 혼합형 |
| **Character Designer** | 캐릭터 설계, 성격, 대사 톤, 관계도, 아크 | 소설형, 혼합형 |
| **Story Architect** | 플롯 구조, 긴장 곡선, 클라이맥스, 테마 설계 | 소설형, 혼합형 |
| **Continuity Checker** | 내적 일관성 검증, 설정 모순 탐지, 반복 표현 적발 | 소설형, 혼합형 |

### 정보전달 전용 에이전트 (정보전달형/혼합형에만 참여)

| 에이전트 | 역할 | 참여 조건 |
|----------|------|----------|
| **Fact Checker** | 데이터 정확성, 출처 검증, 논리 비약 탐지 | 정보전달형, 혼합형 |

---

## 유형별 에이전트 팀 자동 구성

```
정보전달형:
  Orchestrator → Researcher → Planner → [Writer] → Fact Checker → Editor → Publisher

소설형:
  Orchestrator → Researcher → World Builder → Character Designer → Story Architect
  → Planner → [Writer] → Continuity Checker → Editor → Publisher

혼합형:
  Orchestrator → Researcher → Planner(정보) → World Builder → Character Designer
  → Story Architect → Planner(통합) → [Writer] → Continuity Checker → Fact Checker
  → Editor → Publisher
```

> **Writer는 별도 에이전트가 아니라 Orchestrator(메인 Claude)가 직접 수행한다.**
> 다른 에이전트들이 준비한 설계 문서를 기반으로 집필한다.

---

## 파이프라인 (Phase 0~4)

### Phase 0: 조사 (필수 — 건너뛸 수 없음)

**Researcher 수행 항목:**

1. **기존 컨벤션 분석** ★ 항상 수행
   - 프로젝트 내 기존 콘텐츠의 문체, 구조, 패턴 분석
   - `editorial-base.css` 컴포넌트 확인
   - 같은 유형의 기존 시리즈가 있으면 참조
   - 기존 시리즈에서 발생한 문제점 확인 (반복 표현, 클리셰 등)

2. **주제 조사** ★ 항상 수행
   - 2024년 이후 최신 자료 우선
   - 한국 맥락 데이터 포함
   - 반대 의견/반박 자료 수집 (균형 확보)
   - 출처 URL 기록

3. **소설형 추가 조사** (소설형/혼합형일 때)
   - 유사 장르 작품의 세계관/캐릭터 패턴 분석
   - 해당 장르의 클리셰 목록 수집 (회피용)
   - 참고할 수 있는 우수 작품 레퍼런스 수집
   - 설정 시 흔히 빠지는 함정 (모순, 스케일 문제, 시간축 오류) 정리

**출력:** `plans/[시리즈-슬러그]/research.md`

---

### Phase 1: 설계

콘텐츠 유형에 따라 경로가 분기된다.

#### 정보전달형 설계

```
[1] Planner: 시리즈 구조 설계
    ├── 편 수, 각 편의 역할, 논리 흐름
    └── Part 구성과 핵심 데이터 배치

[2] 사용자 확인 ← ★ 체크포인트
```

#### 소설형/혼합형 설계

```
[1] World Builder: 세계관 설계서 작성
    ├── 시공간 설정 (장소, 시대, 규모)
    ├── 규칙 체계 (마법/기술/사회 규칙)
    ├── 역사적 배경과 시간축
    ├── 핵심 용어 사전 (glossary)
    └── 금지 사항 (설정 모순 방지 규칙)

[2] Character Designer: 캐릭터 설계서 작성
    ├── 주요 인물 프로필 (성격, 동기, 말투, 외형)
    ├── 인물 관계도
    ├── 캐릭터 아크 (시작 → 변화 → 종착)
    ├── 대사 톤 가이드 (캐릭터별 말투 규칙)
    └── 금지 사항 (OOC 방지 규칙)

[3] Story Architect: 플롯 설계서 작성
    ├── 시리즈 전체 아크 (기-승-전-결)
    ├── 편별 플롯 아웃라인 (장면 단위)
    ├── 긴장 곡선 (텐션 그래프)
    ├── 핵심 갈등과 해소 포인트
    ├── 테마와 모티프 설계
    └── 복선/반전 설계

[4] Planner: 통합 구조 확정
    ├── 세계관 + 캐릭터 + 플롯을 시리즈 편 구성에 매핑
    ├── 각 편의 Part 구성, 장면 배치, 핵심 씬
    └── 디자인 노트 (필요한 CSS 컴포넌트)

[5] 사용자 확인 ← ★ 체크포인트
    ├── 세계관 설계서 요약
    ├── 캐릭터 설계서 요약
    ├── 플롯 설계서 요약
    └── 시리즈 구조 요약
```

**설계 문서 출력:**
```
plans/[시리즈-슬러그]/
├── research.md           # 자료조사 결과
├── series-plan.md        # 시리즈 기획서 (통합)
├── worldbuilding.md      # 세계관 설계서 (소설형)
├── characters.md         # 캐릭터 설계서 (소설형)
└── plot-outline.md       # 플롯 설계서 (소설형)
```

---

### Phase 2: 집필

Orchestrator가 설계 문서를 기반으로 직접 HTML 콘텐츠를 작성한다.

**집필 규칙:**
- **설계서에 없는 설정을 즉흥으로 추가하지 않는다** (필요하면 설계서부터 업데이트)
- `editorial-content-page` + `seo` 스킬을 참조하여 작성
- 소설형은 `characters.md`의 대사 톤 가이드를 준수
- 한 편씩 작성하고, 편 완성 시마다 Phase 3 검증을 거친다

**집필 중 자가 점검:**
- [ ] 같은 수치/표현이 3회 이상 반복되지 않는가
- [ ] 설정 모순이 없는가 (세계관 설계서 대조)
- [ ] 캐릭터가 설계된 성격에서 벗어나지 않는가
- [ ] 클리셰에 빠지지 않았는가

---

### Phase 3: 검증

편 작성 완료 후 검증 에이전트들이 순차 투입된다.

#### 소설형/혼합형 검증

```
[1] Continuity Checker: 내적 일관성 검증
    ├── 세계관 설계서 vs 본문 대조 (설정 모순 탐지)
    ├── 캐릭터 설계서 vs 대사/행동 대조 (OOC 탐지)
    ├── 시간축 오류 탐지
    ├── 반복 표현 탐지 (같은 단어/숫자/표현이 과도하게 반복)
    ├── 이전 편과의 연속성 검증 (시리즈 내 일관성)
    └── 결과: PASS / FIX_REQUIRED (구체적 수정 지시)

[2] Editor: 문체·품질 검수
    ├── 클리셰 탐지 및 대안 제시
    ├── 과잉 수식 / 과소 묘사 균형
    ├── 문장 리듬과 페이싱
    ├── 감정선 자연스러움 (과장/인위적 전개 탐지)
    ├── 대사 자연스러움 (설명조 대사 제거)
    ├── "보여주기 vs 말하기" 균형
    └── 결과: PASS / REVISION_NEEDED (구체적 수정 지시)
```

#### 정보전달형 검증

```
[1] Fact Checker: 사실 검증
    ├── 데이터/통계 정확성 검증
    ├── 인용 출처 확인
    ├── 논리 비약 탐지
    └── 결과: PASS / FIX_REQUIRED

[2] Editor: 문체·품질 검수
    ├── 가독성 검수
    ├── 전문용어 과다 탐지
    ├── 논리 흐름 자연스러움
    └── 결과: PASS / REVISION_NEEDED
```

#### 공통 검증

```
[3] 기술 검증
    ├── HTML 유효성 (front matter, Nunjucks 호환)
    ├── CSS 컴포넌트 올바른 사용
    ├── 반응형 레이아웃
    ├── 다크 모드 호환
    └── 빌드 테스트 (npx eleventy)
```

---

### Phase 4: 배포 준비

```
[1] Publisher: 배포 체크리스트 실행
    ├── front matter 필수 필드 확인
    ├── content-data.js 업데이트
    ├── series-nav.js 업데이트
    ├── sitemap.xml 업데이트
    ├── catalog.md 업데이트
    ├── content/index.md 업데이트
    └── 빌드 검증 (npx eleventy)

[2] 사용자 확인 ← ★ 최종 체크포인트
    └── 배포(ship) 여부 결정
```

---

## 재시도 정책

| 검증 결과 | 처리 |
|----------|------|
| Continuity Checker: FIX_REQUIRED | 지적된 설정/일관성 오류 수정 → 재검증 (최대 2회) |
| Editor: REVISION_NEEDED | 문체/품질 수정 → 재검증 (최대 2회) |
| Fact Checker: FIX_REQUIRED | 데이터 수정/출처 보강 → 재검증 (최대 2회) |
| 재시도 초과 | 사용자에게 상황 보고 + 판단 요청 |

---

## 소설형 품질 가이드라인

### 반드시 피해야 할 패턴

1. **특정 수치/표현의 과도한 반복**
   - 같은 숫자(예: "300년")가 편당 3회 이상 나오면 경고
   - 대안 표현 자동 제안: "수 세기", "오랜 세월", "그 오래된", "당시의" 등

2. **파워 판타지 클리셰**
   - 주인공이 모든 위기를 손가락 하나로 해결 → 긴장감 부재
   - 주변 인물이 항상 감탄만 → 입체성 부족
   - 해결: 대가, 딜레마, 실패 장면 반드시 포함

3. **설명조 대사**
   - "나는 300년 전에 신을 죽인 존재다" 같은 자기 설명 대사
   - 해결: 행동과 상황으로 보여주기

4. **일관성 없는 파워 스케일**
   - 1편에서 손짓 하나로 해결 → 2편에서도 → 3편에서도 → 긴장감 제로
   - 해결: 위기마다 다른 차원의 도전, 파워 사용의 대가

5. **에필로그 공식화**
   - 매 편 끝이 "허브 차 마시며 일상 복귀" → 단조로움
   - 해결: 편마다 다른 결말 톤, 변화의 누적

### Continuity Checker 필수 점검 항목

- [ ] 세계관 설정과 본문이 일치하는가
- [ ] 같은 표현이 편당 3회 이상 반복되지 않는가
- [ ] 캐릭터의 말투가 설계서와 일치하는가
- [ ] 시간축에 모순이 없는가
- [ ] 이전 편에서 일어난 사건이 무시되지 않았는가
- [ ] 파워 스케일이 일관적인가 (갑자기 강해지거나 약해지지 않는가)
- [ ] 클리셰 패턴에 빠지지 않았는가 (위 목록 대조)

---

## 사용자 명령 패턴

| 패턴 | AI 동작 |
|------|---------|
| "~시리즈 만들어줘" | Orchestrator: 유형 판별 → 에이전트 팀 구성 → Phase 0부터 시작 |
| "소설로 ~" / "이야기로 ~" | 소설형 파이프라인 자동 선택 |
| "정리해줘" / "분석해줘" | 정보전달형 파이프라인 자동 선택 |
| "기획 승인" / "설계 승인" | Phase 2(집필)로 진행 |
| "수정: ~" | 해당 설계서 수정 → 영향받는 Phase부터 재실행 |
| "이어서" / "계속" | 마지막 Phase부터 재개 |
| "다시 써줘" / "리라이트" | Phase 0(조사)부터 전체 재시작 |

---

## 에이전트 실행 방식

에이전트는 Claude Code의 `Task` 도구(subagent)로 실행한다:

- **병렬 가능**: Researcher의 여러 조사 항목, Phase 3의 독립 검증들
- **순차 필수**: Phase 간 전환, 설계 → 집필, 집필 → 검증
- **에이전트 결과 포맷**: 각 에이전트는 명확한 결과(PASS/FIX_REQUIRED/REVISION_NEEDED)와 구체적 지적사항을 반환
- **설계 문서는 `plans/[slug]/`에 파일로 저장**: 세션이 끊겨도 이어서 작업 가능
